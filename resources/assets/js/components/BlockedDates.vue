<template>
	<div>
		<ul>
      <span v-for="item in dates" :item="item">
        <li>{{ item.date }} ({{ item.motive }})
          <a href="#" v-on:click="remove(item)">x</a>
        </li>
        <input type="hidden" name="date[]" :value="item.date"></input>
      </span>
		</ul>

    <input type="text"
           v-model="date_input"
           v-on:keyup.enter="add"
           id="date-input"
           placeholder="2018-01-01">

    <input type="text"
           v-model="motive_input"
           v-on:keyup.enter="add"
           id="motive-input"
           placeholder="Feriado prolongado">

    <button type="button" v-on:click="add">Add</button>
	</div>
</template>

<script>
export default {
	data() {
		return {
			dates: [],
      date_input: "",
      motive_input: "",
		}
	},
	methods: {
    add: function() {
      var data = {};
      data['_token'] = $('input[name=_token]').val();
      data['_method'] = 'POST';
      data['date'] = this.date_input;
      data['motive'] = this.motive_input;

      $.ajax({
        url: '/blocked-dates/',
        method: 'POST',
        dataType: 'json',
        data: data,
        complete: function(data) {
          console.debug(data);
        }
      });

      this.dates.push({
        'date': this.date_input,
        'motive': this.motive_input
      });

      this.date_input = "";
      this.motive_input = "";
    },

    remove: function(item) {
      var data = {};
      data['_token'] = $('input[name=_token]').val();
      data['_method'] = 'DELETE';
      data['date'] = item.date;

      $.ajax({
        url: '/blocked-dates/',
        method: 'POST',
        dataType: 'json',
        data: data,
        complete: function(data) {
          console.debug(data);
        }
      });

      this.dates.splice(this.dates.indexOf(item), 1);
    },
	},
	mounted() {
		console.log('Blocked Dates: Component mounted.');

    $(document).on("keypress", "#date-input", function(event) {
      if (event.keyCode == 13) {
        event.preventDefault();
      }
    });

    $(document).on("keypress", "#motive-input", function(event) {
      if (event.keyCode == 13) {
        event.preventDefault();
        $("#date-input").focus();
      }
    });

    self = this;

    $.get('/blocked-dates.json/', function(data) {
      self.dates = data;
    });
	}
}
</script>
